# 4) 지도형 시각화 지침

## A. 공통 규칙
- 지도/시각화 작업을 시작하기 전 `scripts/search_error_notes.py plot` 등 관련 키워드로 오답노트를 먼저 검색해 기존 시행착오를 확인한다.
- **위·경도 격자 지도**를 그릴 땐 항상 **지형(육지)과 해안선**을 함께 표시한다.
- 기본 투영은 `PlateCarree`; 특수 투영이 필요하면 명시적으로 기록한다.
- 데이터 필드가 왜곡되지 않도록 `transform=ccrs.PlateCarree()` 등 투영 인자를 정확히 지정한다.

## B. 구현 체크리스트
1. Cartopy/Matplotlib 사용 시 `ax.coastlines()`과 `cfeature.NaturalEarthFeature`를 활용해 육지·해안선을 추가하고, 동일 해상도(`50m` 등)를 사용해 겹치는 윤곽선을 피한다.
2. 컬러바 단위를 명확히 표기하고, 동일 패널 내에서는 `vmin/vmax`를 공유해 비교 가능성을 유지한다.
3. **영을 중심으로 변동하는 변수**(advection, 응력 등)를 시각화할 때는 `vmin`과 `vmax`를 절대값 기준으로 대칭(예: ±1.5)으로 두고, `cmap='coolwarm'` 또는 사용자 정의 diverging 컬러맵을 사용해 `0` 주변이 흰색, 양수는 붉은색, 음수는 푸른색으로 표현한다.
4. 패널 조합 그래프는 `constrained_layout=True` 또는 `fig.subplots_adjust()`로 충분한 여백을 확보해 축 라벨, 제목, 패널 주석이 서로 겹치지 않도록 한다. 필요한 경우 플롯 위치(행·열)에 따라 라벨 표시 여부를 조건부로 제어한다. 단일 패널에서는 `(a)` 등 패널 식별 문자를 붙이지 않는다.
5. Cartopy `GeoAxes`는 지도 종횡비를 강제로 유지하므로 `figsize`, `wspace`, `hspace`를 경·위도 범위에 맞춰 산출하고, `ax.get_position()`으로 실제 패널 간격을 확인한 뒤 기록한다.
6. 지도 제목, 패널 식별 문자, 축 라벨, 색상바 라벨 등 모든 텍스트 요소는 서로 겹치지 않도록 위치·여백을 조정하고 필요 시 글꼴 크기/패딩을 재설정한다.
7. 색상바 숫자 라벨은 색 경계 값을 기반으로 선택한다. 경계가 많다면 과밀하지 않을 정도로 간격을 두고, 0을 포함할 때는 양·음 대칭이 되도록 짝을 맞춰 표기한다. 라벨 간격은 가능한 한 균일하게 유지하고, 값은 반올림으로 왜곡하지 말고 실제 경계 값을 그대로 보여준다.
8. 색상바·축 단위 표기는 Matplotlib 수학 표기(`r"m$^{-2}$"` 등)를 사용해 지수 표기를 정확히 표현한다.
9. 그리드라인 라벨은 과도하지 않게 조정하고, 경도는 °E/°W, 위도는 °N/°S 표기 규약을 따른다.
10. 고해상도 데이터가 필요할 경우 Natural Earth 10m 리소스를 캐시해 사용한다.
11. 지도 저장 파일명에는 변수명, 기간, `with_land` 여부 등 맥락을 포함한다.
12. 모든 시각화 작업을 마친 후에는 최초 요청 사항·지침 체크리스트를 다시 검토해 반영 여부를 확인하고, 미흡한 항목이 있으면 즉시 수정 후 재생성한다.

## C. 재현성 메모
- 지도 코드 스니펫은 `src/visualization` 하위에 모듈화해 재사용성을 높인다.
- 외부 환경에서 실행 시 필요한 패키지(`cartopy`, `shapely`, `pyproj`) 버전을 README 또는 환경파일에 반영한다.
